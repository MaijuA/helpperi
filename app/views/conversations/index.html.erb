<div class="ui segment">
  <h3>Viestit</h3>
  <table class="table table-striped">
    <tbody class="form-group">

    <thead>
    <tr>
      <th></th>
      <th></th>
      <th>Ilmoitus</th>
    </tr>
    </thead>

    <tbody>
    <% @conversations.each do |conversation| %>

          <% if conversation.sender_id == current_user.id || conversation.recipient_id == current_user.id %>
              <% if conversation.sender_id == current_user.id %>
                  <% recipient = User.find(conversation.recipient_id) %>
              <% else %>
                  <% recipient = User.find(conversation.sender_id) %>
              <% end %>
            <tr>
              <td>
                <p><%= link_to recipient.first_name, user_path(recipient)%></p>
                <p>[tähdet]</p>
              </td>
              <td><%= link_to 'Keskustelu', conversation_messages_path(conversation)%><br>
                <% if Conversation.where(id:conversation.id).user_messages(current_user.id).unread_by(current_user).count > 0 %>
                  <p>Uusia viestejä</p>
                <% end %>
              </td>
              <td>
                <% if conversation.post_id %>
                    <%= link_to Post.find(conversation.post_id).title, post_path(Post.find(conversation.post_id)) %>
                <% end %>
              </td>
            </tr>
          <% end %>
      <% end %>
    </tbody>
  </table>

</div>